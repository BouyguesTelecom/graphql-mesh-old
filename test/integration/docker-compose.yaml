services:
  # <http://localhost:45537/api-docs/products.yml>
  api-products:
    build:
      context: ../api/
      dockerfile: ../api/Dockerfile
    #image: api-products
    ports:
      - 45537:5000
    healthcheck:
      test: curl --fail http://localhost:5000/products || exit 1
      interval: 10s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # <http://localhost:45538/graphql>
  graphql-mesh:
    depends_on:
      api-products:
        condition: service_healthy
    links:
      - api-products
    image: ${IMAGE_TAG:-bouyguestelecom/graphql-mesh:latest}
    environment:
      - DEBUG=1
    ports:
      - 45538:3000
    volumes:
      - ./transforms:/app/transforms
      - ./plugins:/app/plugins
      - ./config.yaml:/app/config.yaml
    restart: unless-stopped
